title:	Fix remaining 95 failing tests after environment setup
state:	OPEN
author:	baldawsari
labels:	bug, testing
comments:	0
assignees:	
projects:	
milestone:	
number:	33
--
## Context
After fixing the test execution environment in PR #32 (issue #20), we now have a working test suite with 561/656 tests passing (85.4% pass rate). The remaining 95 failing tests have implementation-specific issues that need to be addressed.

## Current State
- **Total Tests**: 656
- **Passing**: 561 (85.4%)
- **Failing**: 95 (14.6%)
- **Test Suites**: 7/31 passing

## Failing Test Categories

### 1. Mock Return Value Mismatches
Tests expecting specific return values that don't match the actual implementation:
- `courseGenerator.test.js` - getCourseConfiguration expects different object structure
- `validation.test.js` - File validation logic changed
- `visualIntelligence.test.js` - Mock expectations don't match implementation

### 2. Async/Promise Handling Issues
Tests with timing or promise resolution problems:
- Tests expecting rejections that resolve instead
- Incorrect async/await usage in test assertions

### 3. Module Dependencies
Tests failing due to missing or incorrectly mocked dependencies:
- Supabase chain methods not properly mocked
- Service dependencies not matching actual usage

## Affected Test Files (14 failing files)
- `tests/unit/utils/validation.test.js`
- `tests/unit/services/visualIntelligence.test.js`
- `tests/unit/services/vectorService.test.js`
- `tests/unit/services/htmlExporter.test.js`
- `tests/unit/services/documentProcessor.test.js`
- `tests/unit/services/designEngine.test.js`
- `tests/unit/services/courseGenerator.test.js`
- `tests/unit/services/claudeService.test.js`
- `tests/routes/profile.test.js`
- `tests/performance/loadTest.test.js`
- `tests/integration/api/upload.test.js`
- `tests/integration/api/export.test.js`
- `tests/integration/api/courses.test.js`
- `tests/integration/api/auth.test.js`

## Action Items
1. Run tests individually to identify specific failures
2. Update mock expectations to match current implementation
3. Fix async/promise handling in tests
4. Ensure all service dependencies are properly mocked
5. Update test assertions to match actual API responses

## Success Criteria
- [ ] All 656 tests passing
- [ ] 31/31 test suites passing
- [ ] CI/CD pipeline fully green
- [ ] No flaky tests
- [ ] Test execution time < 30 seconds

## Priority
Medium - Tests are now executable, but full coverage needed for confidence in deployments

## References
- PR #32: Test environment fixes
- Issue #20: Original test execution environment issue
